<!DOCTYPE html>
<html>
  <head>
	<title>Example page</title>
  </head>
  <body data-server-no-reload>
	<nav>
			<a href="index.html">Cerca Dominio</a>
			<a href="mydomain.html">I miei domini</a>
			<a href="services.html">Services</a>
			<a href="contact.html">Contact</a>
		</nav>
	<h2>Domini registrati</h2>
	<table border="1">
	  <thead>
		<tr>
		  <th>Domain Name</th>
		  <th>Registration Date</th>
		  <th>ExprirationDate</th>
		  <th>Status</th>
		</tr>
	  </thead>
	  <tbody id="domain-table-body">
		<!-- Qui andranno inserite le righe dei domini -->
	  </tbody>
	</table>
	<script>
	  const API_URI = "http://localhost:8080";

	  async function init() {
		const userId = localStorage.getItem('sessionId');
		if (!userId) {
			window.location.href = './auth/login.html';
			return;
		}

		try {
		  const response = await fetch(`${API_URI}/users/${userId}/domains`);
		  
		  if (!response.ok) {
			if (response.status === 404) {
				console.log("User not found or has no domains.");
				document.getElementById('domain-table-body').innerHTML = '<tr><td colspan="4">No domains found.</td></tr>';
			}
			throw new Error(`Errore nella risposta: ${response.status} ${response.statusText}`);
		  }

		  const data = await response.json();
		  populateDomainTable(data);
		} catch (error) {
		  console.error('An error occurred while fetching data:', error);
		}
	  }

	  function populateDomainTable(domains) {
		const tbody = document.getElementById('domain-table-body');
		tbody.innerHTML = ''; // Clear existing rows

		domains.forEach(domain => {
		  const row = tbody.insertRow();

		  row.insertCell().textContent = domain.name;
		  // Use lastContract properties which match the Java model
		  row.insertCell().textContent = new Date(domain.lastContract.acquisitionDate).toLocaleDateString('it-IT');
		  row.insertCell().textContent = new Date(domain.lastContract.expirationDate).toLocaleDateString('it-IT');
		  row.insertCell().textContent = domain.status;
		});
	  }
	  window.onload = init;
	</script>
  </body>
</html>
